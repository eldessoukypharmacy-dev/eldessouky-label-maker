name: Build El Dessouky Label Maker

on:
push:
branches:
- main
workflow_dispatch:

jobs:
build:
runs-on: windows-latest

steps:
  - name: Checkout repository
    uses: actions/checkout@v4

  - name: Set up Python
    uses: actions/setup-python@v5
    with:
      python-version: '3.11'

  - name: Install dependencies
    shell: pwsh
    run: |
      python -m pip install --upgrade pip
      if (Test-Path "requirements.txt") { pip install -r requirements.txt }
      pip install pyinstaller

  - name: Build executable with PyInstaller
    shell: pwsh
    run: |
      # **التعديل هنا: تمت إضافة --clean لحل مشكلة 'failed to start embeded python'**
      pyinstaller --noconfirm --onefile --windowed --icon=Icon.ico --clean main.py
    # **التعديل الثاني: تم تصحيح مكان وضع continue-on-error ليكون على مستوى الخطوة**
    continue-on-error: false

  - name: Create release folder
    shell: pwsh
    run: |
      if (Test-Path "release") { Remove-Item -Recurse -Force release }
      New-Item -ItemType Directory release
      Copy-Item -Path "dist/main.exe" -Destination "release/ElDessouky-LabelMaker.exe"

  - name: Upload EXE as artifact
    uses: actions/upload-artifact@v4
    with:
      name: ElDessouky-LabelMaker
      path: release/ElDessouky-LabelMaker.exe
